import{a as pe}from"./chunk-4IRI426S.js";import{o as ae,w as se}from"./chunk-A7W5PIHO.js";import{a as q}from"./chunk-3OJLRKBR.js";import{$a as V,Ab as te,Bb as ie,Ca as y,Fa as h,Ga as c,H as L,I as E,Ja as x,Jb as ne,K as Y,Ka as J,Ma as K,Mb as re,N as _,Na as W,O as N,Oa as X,Pb as O,Qa as s,Qb as oe,Ra as S,Sa as g,T as d,Ta as Z,U as u,Va as b,a as Q,ab as j,da as z,ea as a,fa as v,o as T,pb as ee,qa as l,qb as P,r as M,sa as m,ua as $,wa as r,wb as D,xa as o,y as B,ya as C}from"./chunk-JB4EPEJV.js";function ue(i,t){if(i&1){let e=y();r(0,"div",1)(1,"div",2),C(2,"img",3),r(3,"div",4)(4,"button",5),h("click",function(){d(e);let p=c();return u(p.addItemToBasket())}),o(),r(5,"button",6),s(6," View "),o()()(),r(7,"div",7)(8,"a",8)(9,"h6",9),s(10),o()(),r(11,"span",10),s(12),V(13,"currency"),o()()()}if(i&2){let e=c();a(2),x("src",e.product.pictureUrl,z),x("alt",e.product.name),a(3),J("routerLink","/shop/",e.product.id,""),a(5),g(" ",e.product.name," "),a(2),S(j(13,6,e.product.price))}}var F=class i{constructor(t){this.basketService=t}product;addItemToBasket(){this.product&&this.basketService.addItemToBasket(this.product)}static \u0275fac=function(e){return new(e||i)(v(q))};static \u0275cmp=_({type:i,selectors:[["app-product-item"]],inputs:{product:"product"},standalone:!0,features:[b],decls:1,vars:1,consts:[["class","card h-100 shadow-sm",4,"ngIf"],[1,"card","h-100","shadow-sm"],[1,"image","position-relative",2,"cursor","pointer"],[1,"img-fluid","bg-info",3,"src","alt"],[1,"d-flex","align-items-center","justify-content-center","hover-overlay"],[1,"btn","btn-primary","fa","fa-shopping-cart","me-2",3,"click"],[1,"btn","btn-primary",3,"routerLink"],[1,"card-body","d-flex","flex-column"],["href","",1,"text-decoration-none"],[1,"text-uppercase"],[1,"mb-2"]],template:function(e,n){e&1&&l(0,ue,14,8,"div",0),e&2&&m("ngIf",n.product)},dependencies:[P,D,O,re],styles:[".btn[_ngcontent-%COMP%]{width:30%;height:40px}.image[_ngcontent-%COMP%]   [_ngcontent-%COMP%]:hover{opacity:1}.image[_ngcontent-%COMP%]   [_ngcontent-%COMP%]:hover   button[_ngcontent-%COMP%]{transform:none;opacity:1}.hover-overlay[_ngcontent-%COMP%]{position:absolute;width:100%;height:100%;top:0;left:0;background:#ffffff80;opacity:0;transition:all .5s}.hover-overlay[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{z-index:1000;transition:all .5s}.hover-overlay[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:first-of-type{transform:translate(-20px)}.hover-overlay[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:last-of-type{transform:translate(20px)}"]})};var k=class{brandId=0;typeId=0;sort="name";pageNumber=1;pageSize=6;search="";getValues(t){switch(t){case"brandId":return this.brandId?this.brandId:null;case"typeId":return this.typeId?this.typeId:null;case"sort":return this.sort?this.sort:null;case"pageNumber":return this.pageNumber?this.pageNumber:null;case"pageSize":return this.pageSize?this.pageSize:null;case"search":return this.search?this.search:null;default:break}}};var w=class i{constructor(t){this.http=t}baseUrl=oe.apiUrl;products=[];brands=[];types=[];pagination;shopParams=new k;productCache=new Map;getProducts(t=!0){if(t||(this.productCache=new Map),this.productCache.size>0&&t&&(console.log(Object.values(this.shopParams).join("-")),this.productCache.has(Object.values(this.shopParams).join("-"))&&(this.pagination=this.productCache.get(Object.values(this.shopParams).join("-")),this.pagination)))return T(this.pagination);let e=new te;return this.shopParams.brandId>0&&(e=e.append("brandId",this.shopParams.brandId)),this.shopParams.typeId>0&&(e=e.append("typeId",this.shopParams.typeId)),this.shopParams.sort&&(e=e.append("sort",this.shopParams.sort)),this.shopParams.pageNumber&&(e=e.append("pageIndex",this.shopParams.pageNumber)),this.shopParams.pageSize&&(e=e.append("pageSize",this.shopParams.pageSize)),this.shopParams.search&&(e=e.append("search",this.shopParams.search)),this.http.get(this.baseUrl+"products",{params:e}).pipe(M(n=>(this.productCache.set(Object.values(this.shopParams).join("-"),n),n)))}getProduct(t){let e=[...this.productCache.values()].reduce((n,p)=>Q(Q({},n),p.data.find(f=>f.id===t)),{});return Object.keys(e).length!==0?T(e):this.http.get(this.baseUrl+"products/"+t)}getBrands(){return this.brands.length>0?T(this.brands):this.http.get(this.baseUrl+"products/brands").pipe(M(t=>this.brands=t))}getTypes(){return this.types.length>0?T(this.types):this.http.get(this.baseUrl+"products/types").pipe(M(t=>this.types=t))}getShopParams(){return this.shopParams}setShopParams(t){this.shopParams=t}static \u0275fac=function(e){return new(e||i)(Y(ie))};static \u0275prov=L({token:i,factory:i.\u0275fac,providedIn:"root"})};function he(i,t){if(i&1&&(r(0,"span"),s(1,"Showing "),r(2,"strong"),s(3),o(),s(4," of "),r(5,"strong"),s(6),o(),s(7," Results"),o()),i&2){let e=c(2);a(3),Z(" ",(e.pageNumber-1)*e.pageSize+1," - ",e.pageNumber*e.pageSize>e.totalCount?e.totalCount:e.pageNumber*e.pageSize," "),a(3),S(e.totalCount)}}function fe(i,t){if(i&1&&(r(0,"section"),l(1,he,8,3,"span",0),o()),i&2){let e=c();a(),m("ngIf",e.totalCount>0)}}function ge(i,t){i&1&&(r(0,"span"),s(1," There are "),r(2,"strong"),s(3,"0"),o(),s(4," results for this filter "),o())}var R=class i{pageNumber;pageSize;totalCount;static \u0275fac=function(e){return new(e||i)};static \u0275cmp=_({type:i,selectors:[["app-paging-header"]],inputs:{pageNumber:"pageNumber",pageSize:"pageSize",totalCount:"totalCount"},standalone:!0,features:[b],decls:3,vars:2,consts:[[4,"ngIf"]],template:function(e,n){e&1&&(r(0,"header"),l(1,fe,2,1,"section",0)(2,ge,5,0,"span",0),o()),e&2&&(a(),m("ngIf",n.totalCount&&n.pageNumber&&n.pageSize),a(),m("ngIf",n.totalCount===0))},dependencies:[P]})};var _e=["search"];function ye(i,t){if(i&1&&(r(0,"option",20),s(1),o()),i&2){let e=t.$implicit,n=c(2);m("selected",(e==null?null:e.value)===n.shopParams.sort)("value",e==null?null:e.value),a(),g(" ",e.name," ")}}function Se(i,t){if(i&1){let e=y();r(0,"li",21),h("click",function(){let p=d(e).$implicit,f=c(2);return u(f.onBrandSelected(p.id))}),s(1),o()}if(i&2){let e=t.$implicit,n=c(2);$("active",e.id===n.shopParams.brandId),m("value",e.id),a(),g(" ",e.name," ")}}function be(i,t){if(i&1){let e=y();r(0,"li",21),h("click",function(){let p=d(e).$implicit,f=c(2);return u(f.onTypeSelected(p.id))}),s(1),o()}if(i&2){let e=t.$implicit,n=c(2);$("active",e.id===n.shopParams.typeId),m("value",e.id),a(),g(" ",e.name," ")}}function Pe(i,t){if(i&1&&(r(0,"div",22),C(1,"app-product-item",23),o()),i&2){let e=t.$implicit;a(),m("product",e)}}function Ce(i,t){if(i&1){let e=y();r(0,"div",3)(1,"section",4)(2,"h5",5),s(3,"Sort"),o(),r(4,"select",6),h("change",function(p){d(e);let f=c();return u(f.onSortSelected(p))}),l(5,ye,2,3,"option",7),o(),r(6,"h5",5),s(7,"Brands"),o(),r(8,"ul",8),l(9,Se,2,4,"li",9),o(),r(10,"h5",5),s(11,"Types"),o(),r(12,"ul",8),l(13,be,2,4,"li",9),o()(),r(14,"section",10)(15,"div",11),C(16,"app-paging-header",12),r(17,"div",13)(18,"input",14,0),h("keyup",function(p){d(e);let f=c();return u(f.onSearch(p))}),o(),r(20,"button",15),h("click",function(){d(e);let p=c();return u(p.reset())}),s(21," Reset "),o()()(),r(22,"div",16),l(23,Pe,2,1,"div",17),o(),r(24,"div",18)(25,"app-pager",19),h("pageChanged",function(p){d(e);let f=c();return u(f.onPageChanged(p))}),o()()()()}if(i&2){let e=c();a(5),m("ngForOf",e.sortOptions),a(4),m("ngForOf",e.brands),a(4),m("ngForOf",e.types),a(3),m("totalCount",e.totalCount)("pageNumber",e.shopParams.pageNumber)("pageSize",e.shopParams.pageSize),a(7),m("ngForOf",e.products),a(2),m("totalCount",e.totalCount)("pageSize",e.shopParams.pageSize)("pageNumber",e.shopParams.pageNumber)}}var A=class i{constructor(t){this.shopService=t;this.shopParams=t.getShopParams()}searchTerm;products=[];brands=[];types=[];totalCount=0;shopParams;debounceTimeOut;sortOptions=[{name:"Alphabetical",value:"name"},{name:"Price: Low to high",value:"priceAsc"},{name:"Price: High to low",value:"priceDesc"}];ngOnInit(){this.getProducts(),this.getBrands(),this.getTypes()}getProducts(){this.shopService.getProducts().pipe(B(1)).subscribe({next:t=>{this.products=t.data,this.totalCount=t.count},error:t=>console.log(t)})}getBrands(){this.shopService.getBrands().subscribe({next:t=>this.brands=[{id:0,name:"All"},...t],error:t=>console.log(t)})}getTypes(){this.shopService.getTypes().subscribe({next:t=>this.types=[{id:0,name:"All"},...t],error:t=>console.log(t)})}setShopAndCallGetProducts(t){this.shopService.setShopParams(t),this.shopParams=t,this.getProducts()}onBrandSelected(t){let e=this.shopService.getShopParams();e.brandId=t,e.pageNumber=1,this.setShopAndCallGetProducts(e)}onTypeSelected(t){let e=this.shopService.getShopParams();e.typeId=t,e.pageNumber=1,this.setShopAndCallGetProducts(e)}onSortSelected(t){let e=this.shopService.getShopParams();e.sort=t?.target?.value,this.setShopAndCallGetProducts(e)}onPageChanged(t){let e=this.shopService.getShopParams();e.pageNumber!==t&&(e.pageNumber=t,this.setShopAndCallGetProducts(e))}onSearch(t){let e=t?.target?.value,n=this.shopService.getShopParams();n.search=e,n.pageNumber=1,this.debounceTimeOut&&clearInterval(this.debounceTimeOut),this.debounceTimeOut=setTimeout(()=>{this.setShopAndCallGetProducts(n)},500)}reset(){this.searchTerm&&(this.searchTerm.nativeElement.value=""),this.shopParams=new k,this.shopService.setShopParams(this.shopParams),this.getProducts()}static \u0275fac=function(e){return new(e||i)(v(w))};static \u0275cmp=_({type:i,selectors:[["app-shop"]],viewQuery:function(e,n){if(e&1&&K(_e,5),e&2){let p;W(p=X())&&(n.searchTerm=p.first)}},standalone:!0,features:[b],decls:2,vars:1,consts:[["search",""],[1,"container"],["class","row",4,"ngIf"],[1,"row"],[1,"col-3"],[1,"text-warning","ms-3"],[1,"form-select","mb-4",3,"change"],[3,"selected","value",4,"ngFor","ngForOf"],[1,"list-group","my-3"],["class","list-group-item",3,"active","value","click",4,"ngFor","ngForOf"],[1,"col-9"],[1,"d-flex","justify-content-between","align-items-center","pb-2"],[3,"totalCount","pageNumber","pageSize"],[1,"d-flex","mt-2"],["type","text","placeholder","Search",1,"form-control","me-2",3,"keyup"],[1,"btn","btn-outline-success",3,"click"],[1,"row","row-cols-3","g-3","mb-4"],["class","col",4,"ngFor","ngForOf"],[1,"d-flex","justify-content-center"],[3,"pageChanged","totalCount","pageSize","pageNumber"],[3,"selected","value"],[1,"list-group-item",3,"click","value"],[1,"col"],[3,"product"]],template:function(e,n){e&1&&(r(0,"div",1),l(1,Ce,26,10,"div",2),o()),e&2&&(a(),m("ngIf",n.types.length>0&&n.brands.length>0))},dependencies:[ee,P,F,se,R,ae],styles:[".list-group-item[_ngcontent-%COMP%]{cursor:pointer;padding:10px 20px;font-size:1.1em}.list-group-item.active[_ngcontent-%COMP%]{border-radius:10px}.list-group-item[_ngcontent-%COMP%]:not(.active):hover{color:#fff;background-color:#e95420b3;border-radius:10px}"]})};function xe(i,t){if(i&1&&(r(0,"h5",14),s(1),o()),i&2){let e=c(2);a(),g(" You have ",e.quantityInBasket," of this item in your basket ")}}function Ie(i,t){if(i&1){let e=y();r(0,"div",2)(1,"div",3),C(2,"img",4),o(),r(3,"div",5)(4,"h2"),s(5),o(),r(6,"p",6),s(7),V(8,"currency"),o(),l(9,xe,2,1,"h5",7),r(10,"div",8)(11,"i",9),h("click",function(){d(e);let p=c();return u(p.decrementQuantity())}),o(),r(12,"span",10),s(13),o(),r(14,"i",11),h("click",function(){d(e);let p=c();return u(p.incrementQuantity())}),o(),r(15,"button",12),h("click",function(){d(e);let p=c();return u(p.updateBasket())}),s(16),o()(),r(17,"div",13)(18,"h4"),s(19,"Description"),o(),r(20,"p"),s(21),o()()()()}if(i&2){let e=c();a(2),x("src",e.product.pictureUrl,z),x("alt",e.product.name),a(3),S(e.product.name),a(2),S(j(8,9,e.product.price)),a(2),m("ngIf",e.quantityInBasket>0),a(4),g(" ",e.quantity," "),a(2),m("disabled",e.quantity===e.quantityInBasket),a(),g(" ",e.buttonText," "),a(5),S(e.product.description)}}var H=class i{constructor(t,e,n,p){this.shopService=t;this.bcService=e;this.activatedRoute=n;this.basketService=p;this.bcService.set("@productDetails"," ")}product;quantity=1;quantityInBasket=0;ngOnInit(){this.loadProduct()}loadProduct(){let t=this.activatedRoute.snapshot.paramMap.get("id");t&&this.shopService.getProduct(+t).subscribe({next:e=>{this.product=e,this.bcService.set("@productDetails",e.name),this.setQuantityIntoBasket(+t)},error:e=>console.error("Error:",e)})}setQuantityIntoBasket(t){this.basketService.basketSource$.pipe(B(1)).subscribe({next:e=>{let n=e?.items.find(p=>p.id===t);n&&(this.quantity=n.quantity,this.quantityInBasket=n.quantity)}})}incrementQuantity(){this.quantity++}decrementQuantity(){this.quantity--}updateBasket(){if(this.product)if(this.quantity>this.quantityInBasket){let t=this.quantity-this.quantityInBasket;this.quantityInBasket+=t,this.basketService.addItemToBasket(this.product,t)}else{let t=this.quantityInBasket-this.quantity;this.quantityInBasket-=t,this.basketService.removeItemFromBasket(this.product.id,t)}}get buttonText(){return this.quantityInBasket===0?"Add to basket":"Update basket"}static \u0275fac=function(e){return new(e||i)(v(w),v(pe),v(ne),v(q))};static \u0275cmp=_({type:i,selectors:[["app-product-details"]],standalone:!0,features:[b],decls:2,vars:1,consts:[[1,"container"],["class","row",4,"ngIf"],[1,"row"],[1,"col-6"],[1,"w-100",3,"src","alt"],[1,"col-6","mt-5"],[1,"font-size-style"],["class","text-primary mb-3",4,"ngIf"],[1,"d-flex","justify-content-start","align-items-center"],[1,"fa","fa-minus-circle","text-warning","me-2","increment-decrement-style",3,"click"],[1,"font-weight-bold","font-size-style"],[1,"fa","fa-plus-circle","text-warning","ms-2","increment-decrement-style",3,"click"],[1,"btn","btn-outline-primary","ms-4",3,"click","disabled"],[1,"row","mt-4"],[1,"text-primary","mb-3"]],template:function(e,n){e&1&&(r(0,"div",0),l(1,Ie,22,11,"div",1),o()),e&2&&(a(),m("ngIf",n.product))},dependencies:[P,D],styles:[".container[_ngcontent-%COMP%]   .product-price-font[_ngcontent-%COMP%]{font-size:2em}.container[_ngcontent-%COMP%]   .product-item-font[_ngcontent-%COMP%]{font-size:1.5em}.container[_ngcontent-%COMP%]   .icon-style[_ngcontent-%COMP%], .container[_ngcontent-%COMP%]   .increment-decrement-style[_ngcontent-%COMP%]{cursor:pointer;font-size:2em}.container[_ngcontent-%COMP%]   .font-size-style[_ngcontent-%COMP%]{font-size:1.5em}"]})};var ke=[{path:"",component:A},{path:":id",component:H,data:{breadcrumb:{alias:"productDetails"}}}],U=class i{static \u0275fac=function(e){return new(e||i)};static \u0275mod=N({type:i});static \u0275inj=E({imports:[O.forChild(ke),O]})};var me=class i{static \u0275fac=function(e){return new(e||i)};static \u0275mod=N({type:i});static \u0275inj=E({imports:[U]})};export{me as ShopModule};
