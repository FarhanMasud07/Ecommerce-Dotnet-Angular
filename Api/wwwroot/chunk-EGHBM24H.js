import{Fb as W,H as D,K as N,Ub as R,e as k,f as Wt,g as v,k as U,r as X}from"./chunk-IOLIYBRE.js";var E=k(p=>{"use strict";Object.defineProperty(p,"__esModule",{value:!0});p.output=p.exists=p.hash=p.bytes=p.bool=p.number=p.isBytes=void 0;function O(t){if(!Number.isSafeInteger(t)||t<0)throw new Error(`positive integer expected, not ${t}`)}p.number=O;function K(t){if(typeof t!="boolean")throw new Error(`boolean expected, not ${t}`)}p.bool=K;function z(t){return t instanceof Uint8Array||t!=null&&typeof t=="object"&&t.constructor.name==="Uint8Array"}p.isBytes=z;function P(t,...e){if(!z(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error(`Uint8Array expected of length ${e}, not of length=${t.length}`)}p.bytes=P;function G(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");O(t.outputLen),O(t.blockLen)}p.hash=G;function J(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}p.exists=J;function Q(t,e){P(t);let n=e.outputLen;if(t.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}p.output=Q;var Rt={number:O,bool:K,bytes:P,hash:G,exists:J,output:Q};p.default=Rt});var Bt=k(c=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});c.add5L=c.add5H=c.add4H=c.add4L=c.add3H=c.add3L=c.add=c.rotlBL=c.rotlBH=c.rotlSL=c.rotlSH=c.rotr32L=c.rotr32H=c.rotrBL=c.rotrBH=c.rotrSL=c.rotrSH=c.shrSL=c.shrSH=c.toBig=c.split=c.fromBig=void 0;var H=BigInt(2**32-1),j=BigInt(32);function M(t,e=!1){return e?{h:Number(t&H),l:Number(t>>j&H)}:{h:Number(t>>j&H)|0,l:Number(t&H)|0}}c.fromBig=M;function Y(t,e=!1){let n=new Uint32Array(t.length),r=new Uint32Array(t.length);for(let o=0;o<t.length;o++){let{h:i,l:a}=M(t[o],e);[n[o],r[o]]=[i,a]}return[n,r]}c.split=Y;var Z=(t,e)=>BigInt(t>>>0)<<j|BigInt(e>>>0);c.toBig=Z;var tt=(t,e,n)=>t>>>n;c.shrSH=tt;var et=(t,e,n)=>t<<32-n|e>>>n;c.shrSL=et;var nt=(t,e,n)=>t>>>n|e<<32-n;c.rotrSH=nt;var rt=(t,e,n)=>t<<32-n|e>>>n;c.rotrSL=rt;var ot=(t,e,n)=>t<<64-n|e>>>n-32;c.rotrBH=ot;var st=(t,e,n)=>t>>>n-32|e<<64-n;c.rotrBL=st;var it=(t,e)=>e;c.rotr32H=it;var ct=(t,e)=>t;c.rotr32L=ct;var at=(t,e,n)=>t<<n|e>>>32-n;c.rotlSH=at;var ut=(t,e,n)=>e<<n|t>>>32-n;c.rotlSL=ut;var lt=(t,e,n)=>e<<n-32|t>>>64-n;c.rotlBH=lt;var pt=(t,e,n)=>t<<n-32|e>>>64-n;c.rotlBL=pt;function ft(t,e,n,r){let o=(e>>>0)+(r>>>0);return{h:t+n+(o/2**32|0)|0,l:o|0}}c.add=ft;var ht=(t,e,n)=>(t>>>0)+(e>>>0)+(n>>>0);c.add3L=ht;var dt=(t,e,n,r)=>e+n+r+(t/2**32|0)|0;c.add3H=dt;var bt=(t,e,n,r)=>(t>>>0)+(e>>>0)+(n>>>0)+(r>>>0);c.add4L=bt;var yt=(t,e,n,r,o)=>e+n+r+o+(t/2**32|0)|0;c.add4H=yt;var gt=(t,e,n,r,o)=>(t>>>0)+(e>>>0)+(n>>>0)+(r>>>0)+(o>>>0);c.add5L=gt;var kt=(t,e,n,r,o,i)=>e+n+r+o+i+(t/2**32|0)|0;c.add5H=kt;var Kt={fromBig:M,split:Y,toBig:Z,shrSH:tt,shrSL:et,rotrSH:nt,rotrSL:rt,rotrBH:ot,rotrBL:st,rotr32H:it,rotr32L:ct,rotlSH:at,rotlSL:ut,rotlBH:lt,rotlBL:pt,add:ft,add3L:ht,add3H:dt,add4L:bt,add4H:yt,add5H:kt,add5L:gt};c.default=Kt});var mt=k(T=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0});T.crypto=void 0;T.crypto=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0});var Lt=k(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0});s.randomBytes=s.wrapXOFConstructorWithOpts=s.wrapConstructorWithOpts=s.wrapConstructor=s.checkOpts=s.Hash=s.concatBytes=s.toBytes=s.utf8ToBytes=s.asyncLoop=s.nextTick=s.hexToBytes=s.bytesToHex=s.byteSwap32=s.byteSwapIfBE=s.byteSwap=s.isLE=s.rotl=s.rotr=s.createView=s.u32=s.u8=s.isBytes=void 0;var F=mt(),q=E();function zt(t){return t instanceof Uint8Array||t!=null&&typeof t=="object"&&t.constructor.name==="Uint8Array"}s.isBytes=zt;var Gt=t=>new Uint8Array(t.buffer,t.byteOffset,t.byteLength);s.u8=Gt;var Jt=t=>new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4));s.u32=Jt;var Qt=t=>new DataView(t.buffer,t.byteOffset,t.byteLength);s.createView=Qt;var Yt=(t,e)=>t<<32-e|t>>>e;s.rotr=Yt;var Zt=(t,e)=>t<<e|t>>>32-e>>>0;s.rotl=Zt;s.isLE=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;var te=t=>t<<24&4278190080|t<<8&16711680|t>>>8&65280|t>>>24&255;s.byteSwap=te;s.byteSwapIfBE=s.isLE?t=>t:t=>(0,s.byteSwap)(t);function ee(t){for(let e=0;e<t.length;e++)t[e]=(0,s.byteSwap)(t[e])}s.byteSwap32=ee;var ne=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function re(t){(0,q.bytes)(t);let e="";for(let n=0;n<t.length;n++)e+=ne[t[n]];return e}s.bytesToHex=re;var f={_0:48,_9:57,_A:65,_F:70,_a:97,_f:102};function wt(t){if(t>=f._0&&t<=f._9)return t-f._0;if(t>=f._A&&t<=f._F)return t-(f._A-10);if(t>=f._a&&t<=f._f)return t-(f._a-10)}function oe(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);let e=t.length,n=e/2;if(e%2)throw new Error("padded hex string expected, got unpadded hex of length "+e);let r=new Uint8Array(n);for(let o=0,i=0;o<n;o++,i+=2){let a=wt(t.charCodeAt(i)),l=wt(t.charCodeAt(i+1));if(a===void 0||l===void 0){let d=t[i]+t[i+1];throw new Error('hex string expected, got non-hex character "'+d+'" at index '+i)}r[o]=a*16+l}return r}s.hexToBytes=oe;var se=()=>v(s,null,function*(){});s.nextTick=se;function ie(t,e,n){return v(this,null,function*(){let r=Date.now();for(let o=0;o<t;o++){n(o);let i=Date.now()-r;i>=0&&i<e||(yield(0,s.nextTick)(),r+=i)}})}s.asyncLoop=ie;function xt(t){if(typeof t!="string")throw new Error(`utf8ToBytes expected string, got ${typeof t}`);return new Uint8Array(new TextEncoder().encode(t))}s.utf8ToBytes=xt;function C(t){return typeof t=="string"&&(t=xt(t)),(0,q.bytes)(t),t}s.toBytes=C;function ce(...t){let e=0;for(let r=0;r<t.length;r++){let o=t[r];(0,q.bytes)(o),e+=o.length}let n=new Uint8Array(e);for(let r=0,o=0;r<t.length;r++){let i=t[r];n.set(i,o),o+=i.length}return n}s.concatBytes=ce;var V=class{clone(){return this._cloneInto()}};s.Hash=V;var ae={}.toString;function ue(t,e){if(e!==void 0&&ae.call(e)!=="[object Object]")throw new Error("Options should be object or undefined");return Object.assign(t,e)}s.checkOpts=ue;function le(t){let e=r=>t().update(C(r)).digest(),n=t();return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=()=>t(),e}s.wrapConstructor=le;function pe(t){let e=(r,o)=>t(o).update(C(r)).digest(),n=t({});return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=r=>t(r),e}s.wrapConstructorWithOpts=pe;function fe(t){let e=(r,o)=>t(o).update(C(r)).digest(),n=t({});return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=r=>t(r),e}s.wrapXOFConstructorWithOpts=fe;function he(t=32){if(F.crypto&&typeof F.crypto.getRandomValues=="function")return F.crypto.getRandomValues(new Uint8Array(t));throw new Error("crypto.getRandomValues must be defined")}s.randomBytes=he});var At=k(u=>{"use strict";Object.defineProperty(u,"__esModule",{value:!0});u.shake256=u.shake128=u.keccak_512=u.keccak_384=u.keccak_256=u.keccak_224=u.sha3_512=u.sha3_384=u.sha3_256=u.sha3_224=u.Keccak=u.keccakP=void 0;var m=E(),x=Bt(),h=Lt(),It=[],Ot=[],Ht=[],de=BigInt(0),w=BigInt(1),be=BigInt(2),ye=BigInt(7),ge=BigInt(256),ke=BigInt(113);for(let t=0,e=w,n=1,r=0;t<24;t++){[n,r]=[r,(2*n+3*r)%5],It.push(2*(5*r+n)),Ot.push((t+1)*(t+2)/2%64);let o=de;for(let i=0;i<7;i++)e=(e<<w^(e>>ye)*ke)%ge,e&be&&(o^=w<<(w<<BigInt(i))-w);Ht.push(o)}var[Be,me]=(0,x.split)(Ht,!0),_t=(t,e,n)=>n>32?(0,x.rotlBH)(t,e,n):(0,x.rotlSH)(t,e,n),St=(t,e,n)=>n>32?(0,x.rotlBL)(t,e,n):(0,x.rotlSL)(t,e,n);function Tt(t,e=24){let n=new Uint32Array(10);for(let r=24-e;r<24;r++){for(let a=0;a<10;a++)n[a]=t[a]^t[a+10]^t[a+20]^t[a+30]^t[a+40];for(let a=0;a<10;a+=2){let l=(a+8)%10,d=(a+2)%10,B=n[d],g=n[d+1],Dt=_t(B,g,1)^n[l],Nt=St(B,g,1)^n[l+1];for(let I=0;I<50;I+=10)t[a+I]^=Dt,t[a+I+1]^=Nt}let o=t[2],i=t[3];for(let a=0;a<24;a++){let l=Ot[a],d=_t(o,i,l),B=St(o,i,l),g=It[a];o=t[g],i=t[g+1],t[g]=d,t[g+1]=B}for(let a=0;a<50;a+=10){for(let l=0;l<10;l++)n[l]=t[a+l];for(let l=0;l<10;l++)t[a+l]^=~n[(l+2)%10]&n[(l+4)%10]}t[0]^=Be[r],t[1]^=me[r]}n.fill(0)}u.keccakP=Tt;var L=class t extends h.Hash{constructor(e,n,r,o=!1,i=24){if(super(),this.blockLen=e,this.suffix=n,this.outputLen=r,this.enableXOF=o,this.rounds=i,this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,(0,m.number)(r),0>=this.blockLen||this.blockLen>=200)throw new Error("Sha3 supports only keccak-f1600 function");this.state=new Uint8Array(200),this.state32=(0,h.u32)(this.state)}keccak(){h.isLE||(0,h.byteSwap32)(this.state32),Tt(this.state32,this.rounds),h.isLE||(0,h.byteSwap32)(this.state32),this.posOut=0,this.pos=0}update(e){(0,m.exists)(this);let{blockLen:n,state:r}=this;e=(0,h.toBytes)(e);let o=e.length;for(let i=0;i<o;){let a=Math.min(n-this.pos,o-i);for(let l=0;l<a;l++)r[this.pos++]^=e[i++];this.pos===n&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;let{state:e,suffix:n,pos:r,blockLen:o}=this;e[r]^=n,n&128&&r===o-1&&this.keccak(),e[o-1]^=128,this.keccak()}writeInto(e){(0,m.exists)(this,!1),(0,m.bytes)(e),this.finish();let n=this.state,{blockLen:r}=this;for(let o=0,i=e.length;o<i;){this.posOut>=r&&this.keccak();let a=Math.min(r-this.posOut,i-o);e.set(n.subarray(this.posOut,this.posOut+a),o),this.posOut+=a,o+=a}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return(0,m.number)(e),this.xofInto(new Uint8Array(e))}digestInto(e){if((0,m.output)(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,this.state.fill(0)}_cloneInto(e){let{blockLen:n,suffix:r,outputLen:o,rounds:i,enableXOF:a}=this;return e||(e=new t(n,r,o,a,i)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=i,e.suffix=r,e.outputLen=o,e.enableXOF=a,e.destroyed=this.destroyed,e}};u.Keccak=L;var b=(t,e,n)=>(0,h.wrapConstructor)(()=>new L(e,t,n));u.sha3_224=b(6,144,224/8);u.sha3_256=b(6,136,256/8);u.sha3_384=b(6,104,384/8);u.sha3_512=b(6,72,512/8);u.keccak_224=b(1,144,224/8);u.keccak_256=b(1,136,256/8);u.keccak_384=b(1,104,384/8);u.keccak_512=b(1,72,512/8);var Ct=(t,e,n)=>(0,h.wrapXOFConstructorWithOpts)((r={})=>new L(e,t,r.dkLen===void 0?n:r.dkLen,!0));u.shake128=Ct(31,168,128/8);u.shake256=Ct(31,136,256/8)});var Vt=k((je,y)=>{"use strict";var{sha3_512:we}=At(),Ut=24,_=32,$=(t=4,e=Math.random)=>{let n="";for(;n.length<t;)n=n+Math.floor(e()*36).toString(36);return n};function Pt(t){let e=8n,n=0n;for(let r of t.values()){let o=BigInt(r);n=(n<<e)+o}return n}var Et=(t="")=>Pt(we(t)).toString(36).slice(1),vt=Array.from({length:26},(t,e)=>String.fromCharCode(e+97)),xe=t=>vt[Math.floor(t()*vt.length)],jt=({globalObj:t=typeof global<"u"?global:typeof window<"u"?window:{},random:e=Math.random}={})=>{let n=Object.keys(t).toString(),r=n.length?n+$(_,e):$(_,e);return Et(r).substring(0,_)},Mt=t=>()=>t++,Le=476782367,Ft=({random:t=Math.random,counter:e=Mt(Math.floor(t()*Le)),length:n=Ut,fingerprint:r=jt({random:t})}={})=>function(){let i=xe(t),a=Date.now().toString(36),l=e().toString(36),d=$(n,t),B=`${a+d+l+r}`;return`${i+Et(B).substring(1,n)}`},_e=Ft(),Se=(t,{minLength:e=2,maxLength:n=_}={})=>{let r=t.length,o=/^[0-9a-z]+$/;try{if(typeof t=="string"&&r>=e&&r<=n&&o.test(t))return!0}finally{}return!1};y.exports.getConstants=()=>({defaultLength:Ut,bigLength:_});y.exports.init=Ft;y.exports.createId=_e;y.exports.bufToBigInt=Pt;y.exports.createCounter=Mt;y.exports.createFingerprint=jt;y.exports.isCuid=Se});var qt=k((Me,S)=>{"use strict";var{createId:Ie,init:Oe,getConstants:He,isCuid:Te}=Vt();S.exports.createId=Ie;S.exports.init=Oe;S.exports.getConstants=He;S.exports.isCuid=Te});var $t=Wt(qt()),A=class{id=(0,$t.createId)();items=[];shippingPrice=0;coupon};var Xt=class t{constructor(e){this.http=e}baseUrl=R.apiUrl;basketSource=new U(null);basketSource$=this.basketSource.asObservable();basketTotalSource=new U(null);basketTotalSource$=this.basketTotalSource.asObservable();createPaymentIntent(){return this.http.post(this.baseUrl+"payments/"+this.getCurrentBasketValue()?.id,{}).pipe(X(e=>{this.basketSource.next(e)}))}setShippingPrice(e){let n=this.getCurrentBasketValue();n&&(n.shippingPrice=e.price,n.deliveryMetodId=e.id,this.setBasket(n))}getBasket(e){return this.http.get(this.baseUrl+"basket?id="+e).subscribe({next:n=>{this.basketSource.next(n),this.calculateTotals()}})}setBasket(e){return this.http.post(this.baseUrl+"basket",e).subscribe({next:n=>{this.basketSource.next(n),this.calculateTotals()}})}getCurrentBasketValue(){return this.basketSource.value}addItemToBasket(e,n=1){this.isProduct(e)&&(e=this.mapProductItemToBasketItem(e));let r=this.getCurrentBasketValue()??this.createBasket();r.items=this.addOrUpdateItem(r.items,e,n),this.setBasket(r)}removeItemFromBasket(e,n=1){let r=this.getCurrentBasketValue();if(!r)return;let o=r.items.find(i=>i.id===e);o&&(o.quantity-=n,o.quantity===0&&(r.items=r.items.filter(i=>i.id!==e)),r.items.length>0?this.setBasket(r):this.deleteBasket(r))}deleteBasket(e){return this.http.delete(this.baseUrl+"basket?id="+e.id).subscribe({next:()=>{this.deleteLocalBasket()}})}applyDiscount(e){return this.http.get(this.baseUrl+"coupons/"+e)}deleteLocalBasket(){this.basketSource.next(null),this.basketTotalSource.next(null),localStorage.removeItem("basket_id")}addOrUpdateItem(e,n,r){let o=e.find(i=>i.id===n.id);return o?o.quantity+=r:(n.quantity=r,e.push(n)),e}createBasket(){let e=new A;return localStorage.setItem("basket_id",e.id),e}mapProductItemToBasketItem(e){return{id:e.id,productName:e.name,price:e.price,quantity:0,pictureUrl:e.pictureUrl,brand:e.productBrand,type:e.productType}}calculateTotals(){let e=this.getCurrentBasketValue();if(!e)return;let n=e.items.reduce((i,a)=>a.price*a.quantity+i,0),r=0;e.coupon&&(e.coupon.amountOff?r=e.coupon.amountOff:e.coupon.percentOff&&(r=n*(e.coupon.percentOff/100)));let o=n+e.shippingPrice-r;this.basketTotalSource.next({shipping:e.shippingPrice,total:o,discount:r,subtotal:n})}isProduct(e){return e.productBrand!==void 0}static \u0275fac=function(n){return new(n||t)(N(W))};static \u0275prov=D({token:t,factory:t.\u0275fac,providedIn:"root"})};export{Xt as a};
